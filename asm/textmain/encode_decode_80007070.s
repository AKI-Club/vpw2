# <Zoinkity> 80007070 is an encode/decode function
# "encode/decode wide string A1 of length A2 to A0 as indices or chars (A3)"

# Params
# $a0 - Destination
# $a1 - Source data location
# $a2 - Length
# $a3 - Command to perform (0=lookup/decode or 1=search/encode)

glabel encode_decode
/* 007C70 80007070 27BDFFF0 */  addiu $sp, $sp, -0x10
/* 007C74 80007074 10E00039 */  beqz  $a3, .L8000715C
/* 007C78 80007078 00806021 */   addu  $t4, $a0, $zero

/* 007C7C 8000707C 18C00064 */  blez  $a2, .L80007210
/* 007C80 80007080 00004821 */   addu  $t1, $zero, $zero

/* 007C84 80007084 240DFFF0 */  li    $t5, -16
/* 007C88 80007088 00005821 */  addu  $t3, $zero, $zero

# primary function (command 1)
.L8000708C:
/* 007C8C 8000708C 90A20000 */  lbu   $v0, ($a1)
/* 007C90 80007090 14400005 */  bnez  $v0, .L800070A8
/* 007C94 80007094 00A05021 */   addu  $t2, $a1, $zero

/* 007C98 80007098 08001C3C */  j     .L800070F0
/* 007C9C 8000709C 24070FFF */   li    $a3, 4095

.L800070A0:
/* 007CA0 800070A0 08001C39 */  j     .L800070E4
/* 007CA4 800070A4 00E01821 */   addu  $v1, $a3, $zero

.L800070A8:
# font characters location
/* 007CA8 800070A8 3C048007 */  lui   $a0, %hi(bssMain_8006E300) # $a0, 0x8007
/* 007CAC 800070AC 2484E300 */  addiu $a0, %lo(bssMain_8006E300) # addiu $a0, $a0, -0x1d00
/* 007CB0 800070B0 00003821 */  addu  $a3, $zero, $zero
/* 007CB4 800070B4 90A80001 */  lbu   $t0, 1($a1)

.L800070B8:
/* 007CB8 800070B8 90820001 */  lbu   $v0, 1($a0)
/* 007CBC 800070BC 55020005 */  bnel  $t0, $v0, .L800070D4
/* 007CC0 800070C0 24840002 */   addiu $a0, $a0, 2

/* 007CC4 800070C4 91430000 */  lbu   $v1, ($t2)
/* 007CC8 800070C8 90820000 */  lbu   $v0, ($a0)
/* 007CCC 800070CC 1062FFF4 */  beq   $v1, $v0, .L800070A0
/* 007CD0 800070D0 24840002 */   addiu $a0, $a0, 2

.L800070D4:
/* 007CD4 800070D4 90820000 */  lbu   $v0, ($a0)
/* 007CD8 800070D8 1440FFF7 */  bnez  $v0, .L800070B8
/* 007CDC 800070DC 24E70002 */   addiu $a3, $a3, 2

/* 007CE0 800070E0 2403FFFF */  li    $v1, -1

.L800070E4:
/* 007CE4 800070E4 000317C2 */  srl   $v0, $v1, 0x1f
/* 007CE8 800070E8 00621021 */  addu  $v0, $v1, $v0
/* 007CEC 800070EC 00023843 */  sra   $a3, $v0, 1

.L800070F0:
/* 007CF0 800070F0 000B1040 */  sll   $v0, $t3, 1
/* 007CF4 800070F4 04420001 */  bltzl $v0, .L800070FC
/* 007CF8 800070F8 24420007 */   addiu $v0, $v0, 7

.L800070FC:
/* 007CFC 800070FC 000218C3 */  sra   $v1, $v0, 3
/* 007D00 80007100 31220002 */  andi  $v0, $t1, 2
/* 007D04 80007104 10400009 */  beqz  $v0, .L8000712C
/* 007D08 80007108 01832021 */   addu  $a0, $t4, $v1

/* 007D0C 8000710C 90830000 */  lbu   $v1, ($a0)
/* 007D10 80007110 00071103 */  sra   $v0, $a3, 4
/* 007D14 80007114 A0820001 */  sb    $v0, 1($a0)
/* 007D18 80007118 00071100 */  sll   $v0, $a3, 4
/* 007D1C 8000711C 004D1024 */  and   $v0, $v0, $t5
/* 007D20 80007120 00621825 */  or    $v1, $v1, $v0
/* 007D24 80007124 08001C50 */  j     .L80007140
/* 007D28 80007128 A0830000 */   sb    $v1, ($a0)

.L8000712C:
/* 007D2C 8000712C 01831821 */  addu  $v1, $t4, $v1
/* 007D30 80007130 00071203 */  sra   $v0, $a3, 8
/* 007D34 80007134 3042000F */  andi  $v0, $v0, 0xf
/* 007D38 80007138 A0670000 */  sb    $a3, ($v1)
/* 007D3C 8000713C A0620001 */  sb    $v0, 1($v1)

.L80007140:
/* 007D40 80007140 256B0006 */  addiu $t3, $t3, 6
/* 007D44 80007144 25290002 */  addiu $t1, $t1, 2
/* 007D48 80007148 0126102A */  slt   $v0, $t1, $a2
/* 007D4C 8000714C 1440FFCF */  bnez  $v0, .L8000708C
/* 007D50 80007150 24A50002 */   addiu $a1, $a1, 2

/* 007D54 80007154 08001C84 */  j     .L80007210
/* 007D58 80007158 00000000 */   nop   

# secondary function (command 0)
.L8000715C:
/* 007D5C 8000715C 18C0002C */  blez  $a2, .L80007210
/* 007D60 80007160 00004821 */   addu  $t1, $zero, $zero

# font characters location
/* 007D64 80007164 240B0FFF */  li    $t3, 4095
/* 007D68 80007168 3C0A8007 */  lui   $t2, %hi(bssMain_8006E300) # $t2, 0x8007
/* 007D6C 8000716C 254AE300 */  addiu $t2, %lo(bssMain_8006E300) # addiu $t2, $t2, -0x1d00
/* 007D70 80007170 01802021 */  addu  $a0, $t4, $zero
/* 007D74 80007174 00004021 */  addu  $t0, $zero, $zero

.L80007178:
/* 007D78 80007178 00081040 */  sll   $v0, $t0, 1
/* 007D7C 8000717C 04420001 */  bltzl $v0, .L80007184
/* 007D80 80007180 24420007 */   addiu $v0, $v0, 7

.L80007184:
/* 007D84 80007184 000218C3 */  sra   $v1, $v0, 3
/* 007D88 80007188 31220002 */  andi  $v0, $t1, 2
/* 007D8C 8000718C 10400006 */  beqz  $v0, .L800071A8
/* 007D90 80007190 00A31021 */   addu  $v0, $a1, $v1

/* 007D94 80007194 90430000 */  lbu   $v1, ($v0)
/* 007D98 80007198 90420001 */  lbu   $v0, 1($v0)
/* 007D9C 8000719C 00031902 */  srl   $v1, $v1, 4
/* 007DA0 800071A0 08001C6E */  j     .L800071B8
/* 007DA4 800071A4 00021100 */   sll   $v0, $v0, 4

.L800071A8:
/* 007DA8 800071A8 90430001 */  lbu   $v1, 1($v0)
/* 007DAC 800071AC 90420000 */  lbu   $v0, ($v0)
/* 007DB0 800071B0 3063000F */  andi  $v1, $v1, 0xf
/* 007DB4 800071B4 00031A00 */  sll   $v1, $v1, 8

.L800071B8:
/* 007DB8 800071B8 00433821 */  addu  $a3, $v0, $v1
/* 007DBC 800071BC 10EB0005 */  beq   $a3, $t3, .L800071D4
/* 007DC0 800071C0 00071040 */   sll   $v0, $a3, 1

/* 007DC4 800071C4 00401821 */  addu  $v1, $v0, $zero
/* 007DC8 800071C8 30428000 */  andi  $v0, $v0, 0x8000
/* 007DCC 800071CC 10400003 */  beqz  $v0, .L800071DC
/* 007DD0 800071D0 3062FFFF */   andi  $v0, $v1, 0xffff

.L800071D4:
/* 007DD4 800071D4 08001C7C */  j     .L800071F0
/* 007DD8 800071D8 00001021 */   addu  $v0, $zero, $zero

.L800071DC:
/* 007DDC 800071DC 004A1021 */  addu  $v0, $v0, $t2
/* 007DE0 800071E0 90430001 */  lbu   $v1, 1($v0)
/* 007DE4 800071E4 90420000 */  lbu   $v0, ($v0)
/* 007DE8 800071E8 00031A00 */  sll   $v1, $v1, 8
/* 007DEC 800071EC 00431021 */  addu  $v0, $v0, $v1

.L800071F0:
/* 007DF0 800071F0 A0820000 */  sb    $v0, ($a0)
/* 007DF4 800071F4 00021203 */  sra   $v0, $v0, 8
/* 007DF8 800071F8 A0820001 */  sb    $v0, 1($a0)
/* 007DFC 800071FC 24840002 */  addiu $a0, $a0, 2
/* 007E00 80007200 25290002 */  addiu $t1, $t1, 2
/* 007E04 80007204 0126102A */  slt   $v0, $t1, $a2
/* 007E08 80007208 1440FFDB */  bnez  $v0, .L80007178
/* 007E0C 8000720C 25080006 */   addiu $t0, $t0, 6

.L80007210:
/* 007E10 80007210 27BD0010 */  addiu $sp, $sp, 0x10
/* 007E14 80007214 03E00008 */  jr    $ra
/* 007E18 80007218 00000000 */   nop   
