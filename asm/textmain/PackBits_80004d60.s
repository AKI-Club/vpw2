# Params:
# $a0 - location of data to pack
# $a1 - n/a?
# $a2 - related to shifting
# $a3 - also related to shifting
# 0x10($sp) - number of bits to pack?
# 0x14($sp) - when 0, performs setup?

# Returns:
# $v0 - packed bits value?

glabel PackBits
/* 005960 80004D60 27BDFFF8 */  addiu $sp, $sp, -8
/* 005964 80004D64 00806021 */  addu  $t4, $a0, $zero # store packed location in $t4
/* 005968 80004D68 8FA2001C */  lw    $v0, 0x1c($sp)
/* 00596C 80004D6C 00C05021 */  addu  $t2, $a2, $zero
/* 005970 80004D70 8FA80018 */  lw    $t0, 0x18($sp)
/* 005974 80004D74 14400007 */  bnez  $v0, .L80004D94
/* 005978 80004D78 00E05821 */   addu  $t3, $a3, $zero

/* 00597C 80004D7C 3C018005 */  lui   $at, %hi(bssMain_800571F0) # $at, 0x8005
/* 005980 80004D80 A42071F0 */  sh    $zero, %lo(bssMain_800571F0)($at)
/* 005984 80004D84 3C018005 */  lui   $at, %hi(bssMain_800571F2) # $at, 0x8005
/* 005988 80004D88 A42071F2 */  sh    $zero, %lo(bssMain_800571F2)($at)
/* 00598C 80004D8C 080013D7 */  j     .L80004F5C
/* 005990 80004D90 00001021 */   addu  $v0, $zero, $zero

.L80004D94:
/* 005994 80004D94 19000067 */  blez  $t0, .L80004F34
/* 005998 80004D98 00000000 */   nop   

/* 00599C 80004D9C 240D0008 */  li    $t5, 8
/* 0059A0 80004DA0 00003821 */  addu  $a3, $zero, $zero
/* 0059A4 80004DA4 240E0000 */  li    $t6, 0
/* 0059A8 80004DA8 240F0001 */  li    $t7, 1

.L80004DAC:
/* 0059AC 80004DAC 3C028005 */  lui   $v0, %hi(bssMain_800571F2) # $v0, 0x8005
/* 0059B0 80004DB0 944271F2 */  lhu   $v0, %lo(bssMain_800571F2)($v0)
/* 0059B4 80004DB4 01A24823 */  subu  $t1, $t5, $v0
/* 0059B8 80004DB8 00021400 */  sll   $v0, $v0, 0x10
/* 0059BC 80004DBC 00021403 */  sra   $v0, $v0, 0x10
/* 0059C0 80004DC0 01021021 */  addu  $v0, $t0, $v0
/* 0059C4 80004DC4 28420009 */  slti  $v0, $v0, 9
/* 0059C8 80004DC8 1040001E */  beqz  $v0, .L80004E44
/* 0059CC 80004DCC 00091400 */   sll   $v0, $t1, 0x10

/* 0059D0 80004DD0 3C058005 */  lui   $a1, %hi(bssMain_800571F0) # $a1, 0x8005
/* 0059D4 80004DD4 84A571F0 */  lh    $a1, %lo(bssMain_800571F0)($a1)
/* 0059D8 80004DD8 00021403 */  sra   $v0, $v0, 0x10
/* 0059DC 80004DDC 00481023 */  subu  $v0, $v0, $t0
/* 0059E0 80004DE0 01852821 */  addu  $a1, $t4, $a1
/* 0059E4 80004DE4 90A40000 */  lbu   $a0, ($a1)
/* 0059E8 80004DE8 00023680 */  sll   $a2, $v0, 0x1a
/* 0059EC 80004DEC 04C10004 */  bgez  $a2, .L80004E00
/* 0059F0 80004DF0 00000000 */   nop   

/* 0059F4 80004DF4 004BC004 */  sllv  $t8, $t3, $v0
/* 0059F8 80004DF8 10000007 */  b     .L80004E18
/* 0059FC 80004DFC 0000C821 */   addu  $t9, $zero, $zero

.L80004E00:
/* 005A00 80004E00 10C00004 */  beqz  $a2, .L80004E14
/* 005A04 80004E04 004AC004 */   sllv  $t8, $t2, $v0

/* 005A08 80004E08 00023023 */  negu  $a2, $v0
/* 005A0C 80004E0C 00CB3006 */  srlv  $a2, $t3, $a2
/* 005A10 80004E10 0306C025 */  or    $t8, $t8, $a2

.L80004E14:
/* 005A14 80004E14 004BC804 */  sllv  $t9, $t3, $v0

.L80004E18:
/* 005A18 80004E18 03001021 */  addu  $v0, $t8, $zero
/* 005A1C 80004E1C 03201821 */  addu  $v1, $t9, $zero
/* 005A20 80004E20 00642025 */  or    $a0, $v1, $a0
/* 005A24 80004E24 A0A40000 */  sb    $a0, ($a1)
/* 005A28 80004E28 3C028005 */  lui   $v0, %hi(bssMain_800571F2) # $v0, 0x8005
/* 005A2C 80004E2C 944271F2 */  lhu   $v0, %lo(bssMain_800571F2)($v0)
/* 005A30 80004E30 00481021 */  addu  $v0, $v0, $t0
/* 005A34 80004E34 3C018005 */  lui   $at, %hi(bssMain_800571F2) # $at, 0x8005
/* 005A38 80004E38 A42271F2 */  sh    $v0, %lo(bssMain_800571F2)($at)
/* 005A3C 80004E3C 080013BE */  j     .L80004EF8
/* 005A40 80004E40 00004021 */   addu  $t0, $zero, $zero

.L80004E44:
/* 005A44 80004E44 3C058005 */  lui   $a1, %hi(bssMain_800571F0) # $a1, 0x8005
/* 005A48 80004E48 84A571F0 */  lh    $a1, %lo(bssMain_800571F0)($a1)
/* 005A4C 80004E4C 00021403 */  sra   $v0, $v0, 0x10
/* 005A50 80004E50 01021023 */  subu  $v0, $t0, $v0
/* 005A54 80004E54 01852821 */  addu  $a1, $t4, $a1
/* 005A58 80004E58 90A40000 */  lbu   $a0, ($a1)
/* 005A5C 80004E5C 00404021 */  addu  $t0, $v0, $zero
/* 005A60 80004E60 00083680 */  sll   $a2, $t0, 0x1a
/* 005A64 80004E64 04C10004 */  bgez  $a2, .L80004E78
/* 005A68 80004E68 00000000 */   nop   

/* 005A6C 80004E6C 010A1806 */  srlv  $v1, $t2, $t0
/* 005A70 80004E70 10000007 */  b     .L80004E90
/* 005A74 80004E74 00001021 */   addu  $v0, $zero, $zero

.L80004E78:
/* 005A78 80004E78 10C00004 */  beqz  $a2, .L80004E8C
/* 005A7C 80004E7C 010B1806 */   srlv  $v1, $t3, $t0

/* 005A80 80004E80 00083023 */  negu  $a2, $t0
/* 005A84 80004E84 00CA3004 */  sllv  $a2, $t2, $a2
/* 005A88 80004E88 00661825 */  or    $v1, $v1, $a2

.L80004E8C:
/* 005A8C 80004E8C 010A1006 */  srlv  $v0, $t2, $t0

.L80004E90:
/* 005A90 80004E90 00642025 */  or    $a0, $v1, $a0
/* 005A94 80004E94 A0A40000 */  sb    $a0, ($a1)
/* 005A98 80004E98 3C028005 */  lui   $v0, %hi(bssMain_800571F2) # $v0, 0x8005
/* 005A9C 80004E9C 944271F2 */  lhu   $v0, %lo(bssMain_800571F2)($v0)
/* 005AA0 80004EA0 00002021 */  addu  $a0, $zero, $zero
/* 005AA4 80004EA4 00002821 */  addu  $a1, $zero, $zero
/* 005AA8 80004EA8 00491021 */  addu  $v0, $v0, $t1
/* 005AAC 80004EAC 3C018005 */  lui   $at, %hi(bssMain_800571F2) # $at, 0x8005
/* 005AB0 80004EB0 A42271F2 */  sh    $v0, %lo(bssMain_800571F2)($at)
/* 005AB4 80004EB4 00E8102A */  slt   $v0, $a3, $t0
/* 005AB8 80004EB8 1040000D */  beqz  $v0, .L80004EF0
/* 005ABC 80004EBC 00001821 */   addu  $v1, $zero, $zero

.L80004EC0:
/* 005AC0 80004EC0 00042040 */  sll   $a0, $a0, 1
/* 005AC4 80004EC4 000517C2 */  srl   $v0, $a1, 0x1f
/* 005AC8 80004EC8 00822025 */  or    $a0, $a0, $v0
/* 005ACC 80004ECC 00052840 */  sll   $a1, $a1, 1
/* 005AD0 80004ED0 008E2025 */  or    $a0, $a0, $t6
/* 005AD4 80004ED4 24620001 */  addiu $v0, $v1, 1
/* 005AD8 80004ED8 00401821 */  addu  $v1, $v0, $zero
/* 005ADC 80004EDC 00021400 */  sll   $v0, $v0, 0x10
/* 005AE0 80004EE0 00021403 */  sra   $v0, $v0, 0x10
/* 005AE4 80004EE4 0048102A */  slt   $v0, $v0, $t0
/* 005AE8 80004EE8 1440FFF5 */  bnez  $v0, .L80004EC0
/* 005AEC 80004EEC 00AF2825 */   or    $a1, $a1, $t7

.L80004EF0:
/* 005AF0 80004EF0 01445024 */  and   $t2, $t2, $a0
/* 005AF4 80004EF4 01655824 */  and   $t3, $t3, $a1

.L80004EF8:
/* 005AF8 80004EF8 3C028005 */  lui   $v0, %hi(bssMain_800571F2) # $v0, 0x8005
/* 005AFC 80004EFC 844271F2 */  lh    $v0, %lo(bssMain_800571F2)($v0)
/* 005B00 80004F00 00402021 */  addu  $a0, $v0, $zero
/* 005B04 80004F04 28420008 */  slti  $v0, $v0, 8
/* 005B08 80004F08 14400008 */  bnez  $v0, .L80004F2C
/* 005B0C 80004F0C 2482FFF8 */   addiu $v0, $a0, -8

/* 005B10 80004F10 3C038005 */  lui   $v1, %hi(bssMain_800571F0) # $v1, 0x8005
/* 005B14 80004F14 946371F0 */  lhu   $v1, %lo(bssMain_800571F0)($v1)
/* 005B18 80004F18 3C018005 */  lui   $at, %hi(bssMain_800571F2) # $at, 0x8005
/* 005B1C 80004F1C A42271F2 */  sh    $v0, %lo(bssMain_800571F2)($at)
/* 005B20 80004F20 24630001 */  addiu $v1, $v1, 1
/* 005B24 80004F24 3C018005 */  lui   $at, %hi(bssMain_800571F0) # $at, 0x8005
/* 005B28 80004F28 A42371F0 */  sh    $v1, %lo(bssMain_800571F0)($at)

.L80004F2C:
/* 005B2C 80004F2C 1D00FF9F */  bgtz  $t0, .L80004DAC
/* 005B30 80004F30 00000000 */   nop   

.L80004F34:
/* 005B34 80004F34 3C028005 */  lui   $v0, %hi(bssMain_800571F2) # $v0, 0x8005
/* 005B38 80004F38 844271F2 */  lh    $v0, %lo(bssMain_800571F2)($v0)
/* 005B3C 80004F3C 10400005 */  beqz  $v0, .L80004F54
/* 005B40 80004F40 00000000 */   nop   

/* 005B44 80004F44 3C028005 */  lui   $v0, %hi(bssMain_800571F0) # $v0, 0x8005
/* 005B48 80004F48 844271F0 */  lh    $v0, %lo(bssMain_800571F0)($v0)
/* 005B4C 80004F4C 080013D7 */  j     .L80004F5C
/* 005B50 80004F50 24420001 */   addiu $v0, $v0, 1

.L80004F54:
/* 005B54 80004F54 3C028005 */  lui   $v0, %hi(bssMain_800571F0) # $v0, 0x8005
/* 005B58 80004F58 844271F0 */  lh    $v0, %lo(bssMain_800571F0)($v0)

.L80004F5C:
/* 005B5C 80004F5C 03E00008 */  jr    $ra
/* 005B60 80004F60 27BD0008 */   addiu $sp, $sp, 8
