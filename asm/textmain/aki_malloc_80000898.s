# uint* aki_malloc(int size)

glabel aki_malloc
/* 001498 80000898 27BDFFE0 */  addiu $sp, $sp, -0x20
/* 00149C 8000089C AFB00010 */  sw    $s0, 0x10($sp)
/* 0014A0 800008A0 3C108004 */  lui   $s0, %hi(D_8003C890) # $s0, 0x8004
/* 0014A4 800008A4 8E10C890 */  lw    $s0, %lo(D_8003C890)($s0)
/* 0014A8 800008A8 AFB20018 */  sw    $s2, 0x18($sp)
/* 0014AC 800008AC 00809021 */  addu  $s2, $a0, $zero
/* 0014B0 800008B0 AFBF001C */  sw    $ra, 0x1c($sp)
/* 0014B4 800008B4 16000017 */  bnez  $s0, .L80000914 # skip zeroing things out
/* 0014B8 800008B8 AFB10014 */   sw    $s1, 0x14($sp)

# todo: figure out how to deal with this w/r/t the linker
/* 0014BC 800008BC 3C050021 */  lui   $a1, %hi(0x00216600) # lui $a1, 0x21
/* 0014C0 800008C0 34A56600 */  ori   $a1, %lo(0x00216600) # ori $a1, $a1, 0x6600
/* 0014C4 800008C4 3C108018 */  lui   $s0, %hi(malloc_80179200) # $s0, 0x8018
/* 0014C8 800008C8 26109200 */  addiu $s0, %lo(malloc_80179200) # addiu $s0, $s0, -0x6e00
/* 0014CC 800008CC 0C00C950 */  jal   bzero
/* 0014D0 800008D0 02002021 */   addu  $a0, $s0, $zero

/* 0014D4 800008D4 3C020002 */  lui   $v0, %hi(0x00021660) # lui $v0, 2
/* 0014D8 800008D8 34421660 */  ori   $v0, %lo(0x00021660) # ori $v0, $v0, 0x1660
/* 0014DC 800008DC AE100000 */  sw    $s0, ($s0)
/* 0014E0 800008E0 3C018018 */  lui   $at, %hi(malloc_80179204) # $at, 0x8018
/* 0014E4 800008E4 AC229204 */  sw    $v0, %lo(malloc_80179204)($at)
/* 0014E8 800008E8 24020000 */  li    $v0, 0
/* 0014EC 800008EC 3C03BABE */  lui   $v1, (0xBABEFACE >> 16) # lui $v1, 0xbabe
/* 0014F0 800008F0 3463FACE */  ori   $v1, (0xBABEFACE & 0xFFFF) # ori $v1, $v1, 0xface
/* 0014F4 800008F4 3C018004 */  lui   $at, %hi(D_8003C890) # $at, 0x8004
/* 0014F8 800008F8 AC30C890 */  sw    $s0, %lo(D_8003C890)($at)
/* 0014FC 800008FC 3C018018 */  lui   $at, %hi(malloc_80179208) # $at, 0x8018
/* 001500 80000900 AC229208 */  sw    $v0, %lo(malloc_80179208)($at)
/* 001504 80000904 3C018018 */  lui   $at, %hi(malloc_8017920C) # $at, 0x8018
/* 001508 80000908 AC23920C */  sw    $v1, %lo(malloc_8017920C)($at)
/* 00150C 8000090C 3C01800A */  lui   $at, %hi(bssMain_800A404C) # $at, 0x800a
/* 001510 80000910 AC20404C */  sw    $zero, %lo(bssMain_800A404C)($at)

.L80000914:
/* 001514 80000914 2642000F */  addiu $v0, $s2, 0xf
/* 001518 80000918 00021102 */  srl   $v0, $v0, 4
/* 00151C 8000091C 24450001 */  addiu $a1, $v0, 1
/* 001520 80000920 00003821 */  addu  $a3, $zero, $zero
/* 001524 80000924 2406FFFF */  li    $a2, -1
/* 001528 80000928 8E030000 */  lw    $v1, ($s0)
/* 00152C 8000092C 24080000 */  li    $t0, 0
/* 001530 80000930 3C09CAFE */  lui   $t1, (0xCAFE4ABE >> 16) # lui $t1, 0xcafe
/* 001534 80000934 35294ABE */  ori   $t1, (0xCAFE4ABE & 0xFFFF) # ori $t1, $t1, 0x4abe

.L80000938:
/* 001538 80000938 8C640004 */  lw    $a0, 4($v1)
/* 00153C 8000093C 0085102B */  sltu  $v0, $a0, $a1
/* 001540 80000940 14400006 */  bnez  $v0, .L8000095C
/* 001544 80000944 0086102B */   sltu  $v0, $a0, $a2

/* 001548 80000948 10400004 */  beqz  $v0, .L8000095C
/* 00154C 8000094C 00000000 */   nop   

/* 001550 80000950 00603821 */  addu  $a3, $v1, $zero
/* 001554 80000954 02008821 */  addu  $s1, $s0, $zero
/* 001558 80000958 00803021 */  addu  $a2, $a0, $zero

.L8000095C:
/* 00155C 8000095C 3C028004 */  lui   $v0, %hi(D_8003C890) # $v0, 0x8004
/* 001560 80000960 8C42C890 */  lw    $v0, %lo(D_8003C890)($v0)
/* 001564 80000964 5462001C */  bnel  $v1, $v0, .L800009D8
/* 001568 80000968 00608021 */   addu  $s0, $v1, $zero

/* 00156C 8000096C 00E01821 */  addu  $v1, $a3, $zero
/* 001570 80000970 1060001C */  beqz  $v1, .L800009E4
/* 001574 80000974 02208021 */   addu  $s0, $s1, $zero

/* 001578 80000978 8C620004 */  lw    $v0, 4($v1)
/* 00157C 8000097C 14450005 */  bne   $v0, $a1, .L80000994
/* 001580 80000980 00451023 */   subu  $v0, $v0, $a1

/* 001584 80000984 8C620000 */  lw    $v0, ($v1)
/* 001588 80000988 AE020000 */  sw    $v0, ($s0)
/* 00158C 8000098C 0800026B */  j     .L800009AC
/* 001590 80000990 AC600000 */   sw    $zero, ($v1)

.L80000994:
/* 001594 80000994 AC620004 */  sw    $v0, 4($v1)
/* 001598 80000998 00021100 */  sll   $v0, $v0, 4
/* 00159C 8000099C 00621821 */  addu  $v1, $v1, $v0
/* 0015A0 800009A0 AC650004 */  sw    $a1, 4($v1)
/* 0015A4 800009A4 8E020000 */  lw    $v0, ($s0)
/* 0015A8 800009A8 AC620000 */  sw    $v0, ($v1)

.L800009AC:
/* 0015AC 800009AC 3C02800A */  lui   $v0, %hi(bssMain_800A404C) # $v0, 0x800a
/* 0015B0 800009B0 8C42404C */  lw    $v0, %lo(bssMain_800A404C)($v0)
/* 0015B4 800009B4 AC680008 */  sw    $t0, 8($v1)
/* 0015B8 800009B8 AC69000C */  sw    $t1, 0xc($v1)
/* 0015BC 800009BC 3C018004 */  lui   $at, %hi(D_8003C890) # $at, 0x8004
/* 0015C0 800009C0 AC30C890 */  sw    $s0, %lo(D_8003C890)($at)
/* 0015C4 800009C4 24420001 */  addiu $v0, $v0, 1
/* 0015C8 800009C8 3C01800A */  lui   $at, %hi(bssMain_800A404C) # $at, 0x800a
/* 0015CC 800009CC AC22404C */  sw    $v0, %lo(bssMain_800A404C)($at)
/* 0015D0 800009D0 08000279 */  j     .L800009E4
/* 0015D4 800009D4 24630010 */   addiu $v1, $v1, 0x10

.L800009D8:
/* 0015D8 800009D8 8C630000 */  lw    $v1, ($v1)
/* 0015DC 800009DC 0800024E */  j     .L80000938
/* 0015E0 800009E0 00000000 */   nop   

.L800009E4:
/* 0015E4 800009E4 00601021 */  addu  $v0, $v1, $zero
/* 0015E8 800009E8 8FBF001C */  lw    $ra, 0x1c($sp)
/* 0015EC 800009EC 8FB20018 */  lw    $s2, 0x18($sp)
/* 0015F0 800009F0 8FB10014 */  lw    $s1, 0x14($sp)
/* 0015F4 800009F4 8FB00010 */  lw    $s0, 0x10($sp)
/* 0015F8 800009F8 03E00008 */  jr    $ra
/* 0015FC 800009FC 27BD0020 */   addiu $sp, $sp, 0x20
