# Params:
# $a0 -
# $a1 -
# $a2 -
# $a3 - graphics microcode to use (0 = F3DEX2; nonzero = F3DLX2.Rej)

glabel func_80003120
/* 003D20 80003120 27BDFFE8 */  addiu $sp, $sp, -0x18
/* 003D24 80003124 00A04821 */  addu  $t1, $a1, $zero
/* 003D28 80003128 3C028004 */  lui   $v0, %hi(D_8003C8B0) # $v0, 0x8004
/* 003D2C 8000312C 8442C8B0 */  lh    $v0, %lo(D_8003C8B0)($v0)
/* 003D30 80003130 25290008 */  addiu $t1, $t1, 8
/* 003D34 80003134 AFBF0014 */  sw    $ra, 0x14($sp)
/* 003D38 80003138 AFB00010 */  sw    $s0, 0x10($sp)
/* 003D3C 8000313C 8C8A0000 */  lw    $t2, ($a0)
/* 003D40 80003140 01201821 */  addu  $v1, $t1, $zero
/* 003D44 80003144 25290008 */  addiu $t1, $t1, 8
/* 003D48 80003148 00021080 */  sll   $v0, $v0, 2
/* 003D4C 8000314C 3C088005 */  lui   $t0, %hi(bssMain_80052560)
/* 003D50 80003150 01024021 */  addu  $t0, $t0, $v0
/* 003D54 80003154 8D082560 */  lw    $t0, %lo(bssMain_80052560)($t0)
/* 003D58 80003158 00073C00 */  sll   $a3, $a3, 0x10
/* 003D5C 8000315C 3C02E900 */  lui   $v0, 0xe900
/* 003D60 80003160 ACA20000 */  sw    $v0, ($a1)
/* 003D64 80003164 3C02DF00 */  lui   $v0, 0xdf00
/* 003D68 80003168 ACA00004 */  sw    $zero, 4($a1)
/* 003D6C 8000316C AC620000 */  sw    $v0, ($v1)
/* 003D70 80003170 24020001 */  li    $v0, 1
/* 003D74 80003174 AC600004 */  sw    $zero, 4($v1)
/* 003D78 80003178 3C038004 */  lui   $v1, %hi(D_80039620) # $v1, 0x8004
/* 003D7C 8000317C 24639620 */  addiu $v1, %lo(D_80039620) # addiu $v1, $v1, -0x69e0
/* 003D80 80003180 AD022BD0 */  sw    $v0, 0x2bd0($t0)
/* 003D84 80003184 24020002 */  li    $v0, 2
/* 003D88 80003188 AD022BD4 */  sw    $v0, 0x2bd4($t0)
/* 003D8C 8000318C 3C028004 */  lui   $v0, %hi(D_800396F0) # $v0, 0x8004
/* 003D90 80003190 244296F0 */  addiu $v0, %lo(D_800396F0) # addiu $v0, $v0, -0x6910
/* 003D94 80003194 00431023 */  subu  $v0, $v0, $v1
/* 003D98 80003198 AD022BDC */  sw    $v0, 0x2bdc($t0)
/* 003D9C 8000319C 3C028005 */  lui   $v0, %hi(bssMain_80052970) # $v0, 0x8005
/* 003DA0 800031A0 24422970 */  addiu $v0, %lo(bssMain_80052970) # addiu $v0, $v0, 0x2970
/* 003DA4 800031A4 AD022C08 */  sw    $v0, 0x2c08($t0)
/* 003DA8 800031A8 24020C00 */  li    $v0, 3072
/* 003DAC 800031AC 25102BC0 */  addiu $s0, $t0, 0x2bc0
/* 003DB0 800031B0 25042BD0 */  addiu $a0, $t0, 0x2bd0
/* 003DB4 800031B4 AD032BD8 */  sw    $v1, 0x2bd8($t0)
/* 003DB8 800031B8 AD002BF8 */  sw    $zero, 0x2bf8($t0)
/* 003DBC 800031BC AD002BFC */  sw    $zero, 0x2bfc($t0)
/* 003DC0 800031C0 14E00008 */  bnez  $a3, .L800031E4
/* 003DC4 800031C4 AD022C0C */   sw    $v0, 0x2c0c($t0)

# use F3DEX2
/* 003DC8 800031C8 3C028004 */  lui   $v0, %hi(ucode_f3dex2_xbus) # $v0, 0x8004
/* 003DCC 800031CC 2442A350 */  addiu $v0, %lo(ucode_f3dex2_xbus) # addiu $v0, $v0, -0x5cb0
/* 003DD0 800031D0 AD022BE0 */  sw    $v0, 0x2be0($t0)
/* 003DD4 800031D4 3C028005 */  lui   $v0, %hi(D_80049DE0) # $v0, 0x8005
/* 003DD8 800031D8 24429DE0 */  addiu $v0, %lo(D_80049DE0) # addiu $v0, $v0, -0x6220
/* 003DDC 800031DC 08000C7F */  j     .L800031FC
/* 003DE0 800031E0 AD022BE8 */   sw    $v0, 0x2be8($t0)

.L800031E4:
# use F3DLX2.Rej
/* 003DE4 800031E4 3C028004 */  lui   $v0, %hi(ucode_f3dlx2_rej_xbus) # $v0, 0x8004
/* 003DE8 800031E8 2442B6F0 */  addiu $v0, %lo(ucode_f3dlx2_rej_xbus) # addiu $v0, $v0, -0x4910
/* 003DEC 800031EC AD022BE0 */  sw    $v0, 0x2be0($t0)
/* 003DF0 800031F0 3C028005 */  lui   $v0, %hi(D_8004A200) # $v0, 0x8005
/* 003DF4 800031F4 2442A200 */  addiu $v0, %lo(D_8004A200) # addiu $v0, $v0, -0x5e00
/* 003DF8 800031F8 AD022BE8 */  sw    $v0, 0x2be8($t0)

.L800031FC:
# after ucode selection
/* 003DFC 800031FC 3C038004 */  lui   $v1, %hi(D_8003C8B0) # $v1, 0x8004
/* 003E00 80003200 8463C8B0 */  lh    $v1, %lo(D_8003C8B0)($v1)
/* 003E04 80003204 24021000 */  li    $v0, 4096
/* 003E08 80003208 AC820014 */  sw    $v0, 0x14($a0)
/* 003E0C 8000320C 24020800 */  li    $v0, 2048
/* 003E10 80003210 AC82001C */  sw    $v0, 0x1c($a0)
/* 003E14 80003214 3C028005 */  lui   $v0, %hi(bssMain_80052570) # $v0, 0x8005
/* 003E18 80003218 24422570 */  addiu $v0, %lo(bssMain_80052570) # addiu $v0, $v0, 0x2570
/* 003E1C 8000321C AC820020 */  sw    $v0, 0x20($a0)
/* 003E20 80003220 24020400 */  li    $v0, 1024
/* 003E24 80003224 AC820024 */  sw    $v0, 0x24($a0)
/* 003E28 80003228 3C028005 */  lui   $v0, %hi(bssMain_80052560) # $v0, 0x8005
/* 003E2C 8000322C 24422560 */  addiu $v0, %lo(bssMain_80052560) # addiu $v0, $v0, 0x2560
/* 003E30 80003230 00031880 */  sll   $v1, $v1, 2
/* 003E34 80003234 00621821 */  addu  $v1, $v1, $v0
/* 003E38 80003238 8C620000 */  lw    $v0, ($v1)
/* 003E3C 8000323C AC820030 */  sw    $v0, 0x30($a0)
/* 003E40 80003240 8C620000 */  lw    $v0, ($v1)
/* 003E44 80003244 01221023 */  subu  $v0, $t1, $v0
/* 003E48 80003248 00021340 */  sll   $v0, $v0, 0xd
/* 003E4C 8000324C 00021403 */  sra   $v0, $v0, 0x10
/* 003E50 80003250 000210C0 */  sll   $v0, $v0, 3
/* 003E54 80003254 AC820034 */  sw    $v0, 0x34($a0)
/* 003E58 80003258 00061400 */  sll   $v0, $a2, 0x10
/* 003E5C 8000325C 10400003 */  beqz  $v0, .L8000326C
/* 003E60 80003260 AE000000 */   sw    $zero, ($s0)

/* 003E64 80003264 08000C9C */  j     .L80003270
/* 003E68 80003268 24020063 */   li    $v0, 99

.L8000326C:
/* 003E6C 8000326C 24020003 */  li    $v0, 3

.L80003270:
/* 003E70 80003270 AE020008 */  sw    $v0, 8($s0)
/* 003E74 80003274 3C048004 */  lui   $a0, %hi(D_8003C8B0) # $a0, 0x8004
/* 003E78 80003278 8484C8B0 */  lh    $a0, %lo(D_8003C8B0)($a0)
/* 003E7C 8000327C 3C028005 */  lui   $v0, %hi(bssMain_80052560) # $v0, 0x8005
/* 003E80 80003280 24422560 */  addiu $v0, %lo(bssMain_80052560) # addiu $v0, $v0, 0x2560
/* 003E84 80003284 24052C38 */  li    $a1, 11320
/* 003E88 80003288 AE0A000C */  sw    $t2, 0xc($s0)
/* 003E8C 8000328C 00042080 */  sll   $a0, $a0, 2
/* 003E90 80003290 0C00C0E0 */  jal   osWritebackDCache
/* 003E94 80003294 00822021 */   addu  $a0, $a0, $v0

/* 003E98 80003298 0C000185 */  jal   func_80000614
/* 003E9C 8000329C 02002021 */   addu  $a0, $s0, $zero

/* 003EA0 800032A0 3C028004 */  lui   $v0, %hi(D_8003C8B0) # $v0, 0x8004
/* 003EA4 800032A4 9442C8B0 */  lhu   $v0, %lo(D_8003C8B0)($v0)
/* 003EA8 800032A8 24420001 */  addiu $v0, $v0, 1
/* 003EAC 800032AC 00021400 */  sll   $v0, $v0, 0x10
/* 003EB0 800032B0 00021C03 */  sra   $v1, $v0, 0x10
/* 003EB4 800032B4 000217C2 */  srl   $v0, $v0, 0x1f
/* 003EB8 800032B8 00621021 */  addu  $v0, $v1, $v0
/* 003EBC 800032BC 00021043 */  sra   $v0, $v0, 1
/* 003EC0 800032C0 00021040 */  sll   $v0, $v0, 1
/* 003EC4 800032C4 00621823 */  subu  $v1, $v1, $v0
/* 003EC8 800032C8 3C018004 */  lui   $at, %hi(D_8003C8B0) # $at, 0x8004
/* 003ECC 800032CC A423C8B0 */  sh    $v1, %lo(D_8003C8B0)($at)
/* 003ED0 800032D0 8FBF0014 */  lw    $ra, 0x14($sp)
/* 003ED4 800032D4 8FB00010 */  lw    $s0, 0x10($sp)
/* 003ED8 800032D8 03E00008 */  jr    $ra
/* 003EDC 800032DC 27BD0018 */   addiu $sp, $sp, 0x18
